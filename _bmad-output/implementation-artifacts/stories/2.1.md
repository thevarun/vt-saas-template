# Story 2.1: User Registration with Email/Password

Status: ready-for-dev

## Story

As a new user,
I want to create an account with my email and password,
So that I can access the application's features.

## Acceptance Criteria

1. **Given** I am on the sign-up page **When** I enter a valid email and password meeting requirements **Then** my account is created in Supabase **And** a verification email is sent to my address **And** I see a message to check my email

2. **Given** I enter an email that already exists **When** I submit the registration form **Then** I see a clear error message "Email already registered" **And** I am offered a link to sign in instead

3. **Given** I enter a weak password **When** I attempt to submit **Then** I see validation requirements (min 8 chars, complexity) **And** the form does not submit until requirements are met

4. **Given** the registration form **When** I view it on any device **Then** form fields are appropriately sized **And** keyboard type is correct for email field **And** password field has show/hide toggle

## Tasks / Subtasks

- [ ] Extract and adapt MagicPatterns sign-up component (AC: #1, #2, #3, #4)
  - [ ] Use `mcp__magic-patterns__read_files` to extract SignUpPage.tsx from https://www.magicpatterns.com/c/bxmfv74lgsrvfdrwaeqcrt
  - [ ] Install required shadcn components: `npx shadcn@latest add checkbox card`
  - [ ] Create PasswordInput component (extract from MagicPatterns SignInForm.tsx)
  - [ ] Replace existing `src/app/[locale]/(auth)/(center)/sign-up/page.tsx`

- [ ] Implement form validation with react-hook-form + Zod (AC: #3)
  - [ ] Create schema: email (valid email format), password (min 8 chars, 1 uppercase, 1 lowercase, 1 number)
  - [ ] Add real-time validation feedback with error messages
  - [ ] Disable submit button when form invalid

- [ ] Integrate Supabase registration (AC: #1, #2)
  - [ ] Use `createClient()` from `@/libs/supabase/client`
  - [ ] Call `supabase.auth.signUp({ email, password, options: { emailRedirectTo } })`
  - [ ] Handle "User already registered" error and show link to sign-in
  - [ ] Set emailRedirectTo to `/auth/callback` for verification flow

- [ ] Build success state UI (AC: #1)
  - [ ] Show "Check your email" message with user's email address
  - [ ] Display verification instructions
  - [ ] Add "Go to Sign In" button
  - [ ] Use design from MagicPatterns success screen

- [ ] Mobile responsiveness and accessibility (AC: #4)
  - [ ] Test on mobile viewport (375px width minimum)
  - [ ] Ensure password toggle button is accessible (aria-label)
  - [ ] Verify keyboard navigation works correctly
  - [ ] Test with screen reader

## Dev Notes

### Authentication Architecture

**Supabase Client Usage:**
- This is a CLIENT component (`'use client'` required)
- Use `createClient()` from `@/libs/supabase/client` (NOT server client)
- The middleware handles session management - component only calls signUp

**Registration Flow:**
1. User submits form → Client-side validation
2. Call `supabase.auth.signUp()` with emailRedirectTo
3. Supabase sends verification email automatically
4. Show success screen (user NOT signed in yet)
5. User clicks email link → redirects to `/auth/callback` → Story 2.2

**Error Handling:**
- Supabase returns error objects: `{ message: string, status: number }`
- Common errors: "User already registered", "Password too weak", "Invalid email"
- Always show user-friendly messages (map Supabase errors to clean text)

### Design System Integration

**DO NOT BUILD FROM SCRATCH:**
The MagicPatterns design contains production-ready React/TypeScript code. Extract and adapt:

1. **Extract component code:**
   ```
   mcp__magic-patterns__read_files(
     url: "https://www.magicpatterns.com/c/bxmfv74lgsrvfdrwaeqcrt",
     fileNames: ["SignUpPage.tsx"]
   )
   ```

2. **Adapt styling:**
   - Replace gradient purple/pink headings with slate-900 (new design system)
   - Use backdrop blur card from new design: `bg-white/80 backdrop-blur-xl`
   - Social buttons (Google/GitHub) not needed in this story - remove or comment out

3. **PasswordInput component:**
   - Extract from SignInForm.tsx in MagicPatterns
   - Eye/EyeOff toggle from lucide-react
   - Position toggle button inside input (right side)
   - Must be `type="button"` to prevent form submit

4. **Form layout:**
   - Use Card component: `npx shadcn@latest add card`
   - Max width: `max-w-md`
   - Padding: `p-8 sm:p-10`
   - Centered on page with min-height viewport

### Validation Rules

**Email:**
- Use Zod: `z.string().email("Invalid email address")`
- Show error below field on blur

**Password:**
```typescript
z.string()
  .min(8, "Password must be at least 8 characters")
  .regex(/[A-Z]/, "Must contain at least one uppercase letter")
  .regex(/[a-z]/, "Must contain at least one lowercase letter")
  .regex(/[0-9]/, "Must contain at least one number")
```

**Real-time vs Submit Validation:**
- Email: Validate on blur (don't spam user while typing)
- Password: Show requirements list, validate on blur
- Submit: Validate all fields before API call

### Existing Implementation Review

**Current file location:** `src/app/[locale]/(auth)/(center)/sign-up/page.tsx`

**What to keep:**
- Basic Supabase signUp call structure
- Success screen transition logic
- Error display pattern

**What to replace:**
- Replace custom HTML inputs with shadcn Input + PasswordInput
- Replace inline form validation with react-hook-form + Zod
- Update styling to new design system (remove gradient purple/pink)
- Add password strength requirements display
- Improve error messages (map Supabase errors to user-friendly text)

**Password minimum:** Currently set to 6 chars - UPDATE to 8 chars per AC #3

### Project Structure Notes

**Route location:** `src/app/[locale]/(auth)/(center)/sign-up/page.tsx`
- `(auth)` route group - protected by middleware (but sign-up should be accessible)
- WAIT - sign-up should be public, but it's in (auth) group. Check if this breaks access.
- **ACTION:** Verify middleware allows unauthenticated access to `/sign-up`, or move to `(unauth)` group

**Component structure:**
```
src/
├── app/[locale]/(auth)/(center)/sign-up/
│   └── page.tsx (Client Component)
├── components/
│   ├── ui/
│   │   └── password-input.tsx (NEW - extract from MagicPatterns)
│   └── auth/ (if needed for shared auth components)
└── libs/supabase/
    └── client.ts (already exists)
```

**Import paths:**
- ALWAYS use `@/` prefix (NOT relative paths)
- Example: `import { createClient } from '@/libs/supabase/client'`
- Example: `import { PasswordInput } from '@/components/ui/password-input'`

### Testing Requirements

**Unit Tests:**
- Test form validation (invalid email, weak password)
- Test Supabase error handling (mock signUp to return errors)
- Test success state transition

**E2E Tests (Playwright):**
- Full registration flow with test email
- Verify error messages for duplicate email
- Test password requirements validation
- Test mobile viewport responsiveness

**Manual Testing:**
- Create account with real email
- Verify email arrives in inbox
- Test with existing email (error handling)
- Test on mobile device

### References

- [Source: _bmad-output/planning-artifacts/epics/epic-2-complete-authentication-experience.md#Story-2.1]
- [Source: _bmad-output/planning-artifacts/ux-design/epic-2-auth-design-brief.md]
- [Source: _bmad-output/planning-artifacts/ux-design/epic-2-auth-component-strategy.md#PasswordInput]
- [Source: _bmad-output/project-context.md#Authentication-Rules]
- [Source: src/libs/supabase/client.ts]
- [Source: src/middleware.ts#protectedPaths]

## Dev Agent Record

### Agent Model Used

{{agent_model_name_version}}

### Debug Log References

### Completion Notes List

### File List
